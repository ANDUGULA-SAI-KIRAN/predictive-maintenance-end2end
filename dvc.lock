schema: '2.0'
stages:
  ingest:
    cmd: python -m src.data.data_ingest
    deps:
    - path: src/data/data_ingest.py
      hash: md5
      md5: 8f3250f7d1726906bdc1d6b1a05b5040
      size: 3136
    - path: src/validation/schemas.py
      hash: md5
      md5: 9a392c4be500d16d8e55d939d2ecb444
      size: 3421
    params:
      params.yaml:
        ingest:
          remote_file: test.csv
          local_file: test.csv
          output_dir: data/raw
          output_file: combined.csv
    outs:
    - path: data/raw/combined.csv
      hash: md5
      md5: e15bcf1a41c087adc85e87c4e3b75650
      size: 9541253
  preprocess:
    cmd: python -m src.data.preprocess
    deps:
    - path: data/raw/combined.csv
      hash: md5
      md5: e15bcf1a41c087adc85e87c4e3b75650
      size: 9541253
    - path: src/data/preprocess.py
      hash: md5
      md5: 5d17ef92e7cc884d2ba49d05661255ec
      size: 4216
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        preprocess:
          input_path: data/raw/combined.csv
          output_dir: data/processed
          test_size: 0.2
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: 77fe289103729c7a8e0ea23d17a3089a
      size: 1398963
    - path: data/processed/train.csv
      hash: md5
      md5: 132f577d7bdba6e7bee44a1d98a63161
      size: 5595573
  feature_engineer:
    cmd: python -m src.features.feature_engineering
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 77fe289103729c7a8e0ea23d17a3089a
      size: 1398963
    - path: data/processed/train.csv
      hash: md5
      md5: 132f577d7bdba6e7bee44a1d98a63161
      size: 5595573
    - path: src/features/feature_engineering.py
      hash: md5
      md5: e8b73ff5a4e7997219426181d7c4e8cb
      size: 2436
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        feature_eng:
          output_dir: data/feature_engineered
    outs:
    - path: data/feature_engineered/test_enriched.csv
      hash: md5
      md5: d225ff4f7aca5dde5502f43918e13619
      size: 3115419
    - path: data/feature_engineered/train_enriched.csv
      hash: md5
      md5: 6a0b68b3bb1e30c31b85752d1750cc37
      size: 12470971
  train:
    cmd: python -m src.models.train
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 77fe289103729c7a8e0ea23d17a3089a
      size: 1398963
    - path: data/processed/train.csv
      hash: md5
      md5: 132f577d7bdba6e7bee44a1d98a63161
      size: 5595573
    - path: src/features/feature_engineering.py
      hash: md5
      md5: e8b73ff5a4e7997219426181d7c4e8cb
      size: 2436
    - path: src/models/train.py
      hash: md5
      md5: 16ae839dab558c4a61639e57eafbd182
      size: 12750
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        train:
          n_trials: 2
          cv_folds: 5
          experiments:
            rf: RF_Maintenance_DagsHub
            lgbm: LGBM_Maintenance_DagsHub
          rf_params:
            n_estimators:
            - 100
            - 500
            max_depth:
            - 5
            - 30
            min_samples_split:
            - 2
            - 20
            min_samples_leaf:
            - 1
            - 10
            max_features:
            - sqrt
            - log2
            - 0.3
            - 0.5
            - 0.8
            class_weight:
            - balanced
            - 
          lgbm_params:
            n_estimators:
            - 100
            - 500
            max_depth:
            - 5
            - 30
            learning_rate:
            - 0.01
            - 0.2
            num_leaves:
            - 20
            - 150
            min_child_samples:
            - 5
            - 50
            subsample:
            - 0.6
            - 1.0
            colsample_bytree:
            - 0.6
            - 1.0
            class_weight:
            - balanced
            - 
    outs:
    - path: models/
      hash: md5
      md5: c78db0f027ffd75c6f128a1b28bb14a6.dir
      size: 12937165
      nfiles: 2
  evaluate:
    cmd: python -m src.models.evaluate
    deps:
    - path: data/feature_engineered/test_enriched.csv
      hash: md5
      md5: d225ff4f7aca5dde5502f43918e13619
      size: 3115419
    - path: models/lgbm_model.pkl
      hash: md5
      md5: 5577c9f53033f0d6bdeae28190d08460
      size: 1844980
    - path: models/rf_model.pkl
      hash: md5
      md5: 9a8fab3850c3669524dd02e9e845bb4e
      size: 11092185
    - path: src/models/evaluate.py
      hash: md5
      md5: 0d23d9471eb6c8357e159fd783767462
      size: 4533
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        evaluate:
          test_data: data/feature_engineered/test_enriched.csv
          metrics_file: reports/metrics.json
          min_recall_threshold: 0.6
    outs:
    - path: reports/metrics.json
      hash: md5
      md5: 99914b932bd37a50b983c5e7c90ae93b
      size: 2

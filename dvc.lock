schema: '2.0'
stages:
  ingest:
    cmd: python -m src.data.data_ingest
    deps:
    - path: src/data/data_ingest.py
      hash: md5
      md5: 13068f744d3cedf251f61971eff7ed00
      size: 3363
    - path: src/validation/schemas.py
      hash: md5
      md5: c7fcf88e07ba6f043b817a00fc83acac
      size: 3065
    params:
      params.yaml:
        ingest:
          remote_file: test.csv
          local_file: test.csv
          output_dir: data/raw
          output_file: combined.csv
    outs:
    - path: data/raw/combined.csv
      hash: md5
      md5: 88db51c6a52bc3f1d8d4e04b4952fc87
      size: 4770694
  preprocess:
    cmd: python -m src.data.preprocess
    deps:
    - path: data/raw/combined.csv
      hash: md5
      md5: 88db51c6a52bc3f1d8d4e04b4952fc87
      size: 4770694
    - path: src/data/preprocess.py
      hash: md5
      md5: a0be6181977ac4a2c2eaa0d19dbcf038
      size: 2134
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        preprocess:
          input_path: data/raw/combined.csv
          output_dir: data/processed
          test_size: 0.2
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: 65c53ed2b0488bc4220a88d142b73dd2
      size: 553888
    - path: data/processed/train.csv
      hash: md5
      md5: 6e5277cef5f14e8c727519c110190e78
      size: 2215813
  feature_engineer:
    cmd: python -m src.features.feature_engineering
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 65c53ed2b0488bc4220a88d142b73dd2
      size: 553888
    - path: data/processed/train.csv
      hash: md5
      md5: 6e5277cef5f14e8c727519c110190e78
      size: 2215813
    - path: src/features/feature_engineering.py
      hash: md5
      md5: 90524acca92e42f063127434cc0ef4df
      size: 2501
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        feature_eng:
          output_dir: data/feature_engineered
    outs:
    - path: data/feature_engineered/test_enriched.csv
      hash: md5
      md5: 2443aaea2f7565fca51449a09e1ee455
      size: 872137
    - path: data/feature_engineered/train_enriched.csv
      hash: md5
      md5: fd070d8f795dbcfea8ae6ab6481bbeed
      size: 3488979
  train:
    cmd: python -m src.models.train
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 65c53ed2b0488bc4220a88d142b73dd2
      size: 553888
    - path: data/processed/train.csv
      hash: md5
      md5: 6e5277cef5f14e8c727519c110190e78
      size: 2215813
    - path: src/features/feature_engineering.py
      hash: md5
      md5: 90524acca92e42f063127434cc0ef4df
      size: 2501
    - path: src/models/train.py
      hash: md5
      md5: 5f520fd5bd3375058c490c8d6e03f7f6
      size: 12660
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        train:
          n_trials: 10
          cv_folds: 5
          experiments:
            rf: RF_Model
            lgbm: LGBM_Model
          rf_params:
            n_estimators:
            - 100
            - 500
            max_depth:
            - 5
            - 30
            min_samples_split:
            - 2
            - 20
            min_samples_leaf:
            - 1
            - 10
            max_features:
            - sqrt
            - log2
            - 0.3
            - 0.5
            - 0.8
            class_weight:
            - balanced
            - 
          lgbm_params:
            n_estimators:
            - 100
            - 500
            max_depth:
            - 5
            - 30
            learning_rate:
            - 0.01
            - 0.2
            num_leaves:
            - 20
            - 150
            min_child_samples:
            - 5
            - 50
            subsample:
            - 0.6
            - 1.0
            colsample_bytree:
            - 0.6
            - 1.0
            class_weight:
            - balanced
            - 
    outs:
    - path: reports/metrics.json
      hash: md5
      md5: d60a07c0aad1b8e36111902a28672b90
      size: 426
  evaluate:
    cmd: python -m src.models.evaluate
    deps:
    - path: data/feature_engineered/test_enriched.csv
      hash: md5
      md5: 2443aaea2f7565fca51449a09e1ee455
      size: 872137
    - path: models/lgbm_model.pkl
      hash: md5
      md5: 4abfb504e595e131f30d91c3f2e783c1
      size: 822356
    - path: models/rf_model.pkl
      hash: md5
      md5: f306ad613ce6f32e9574a6dc44a5ef4f
      size: 503529
    - path: src/models/evaluate.py
      hash: md5
      md5: e6db6b73d5799265f32bf2dcaaa47d14
      size: 5774
    params:
      params.yaml:
        base:
          random_state: 42
          target_col: machine_failure
        evaluate:
          test_data: data/feature_engineered/test_enriched.csv
          metrics_file: reports/metrics.json
          min_recall_threshold: 0.6
    outs:
    - path: reports/metrics.json
      hash: md5
      md5: 99914b932bd37a50b983c5e7c90ae93b
      size: 2
